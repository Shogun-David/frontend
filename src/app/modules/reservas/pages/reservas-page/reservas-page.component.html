<div class="container-fluid py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-0">
        <i class="uil uil-journal-text me-2"></i>
        Mis Reservas
      </h4>
      <small class="text-muted">
        Gestión y visualización de tus reservas
      </small>
    </div>

    <button class="btn btn-primary" (click)="abrirCrearReserva()">
      <i class="uil uil-plus-circle me-1"></i>
      Nueva Reserva
    </button>
  </div>

  <!-- Filtros -->
  <div class="card mb-3 p-3 shadow-sm">
    <div class="row g-2 align-items-end">

      <div class="col-md-4">
        <label class="form-label">Sala</label>
        <input
          type="text"
          class="form-control"
          placeholder="Buscar por nombre de sala"
          [(ngModel)]="salaFiltro"
          (keyup.enter)="filtrar()"
        />
      </div>

      <div class="col-md-3">
        <label class="form-label">Estado</label>
        <select
          class="form-select"
          [(ngModel)]="estadoFiltro"
          (change)="filtrar()"
        >
          <option value="">Todos</option>
          <option value="ACTIVA">ACTIVA</option>
          <option value="CANCELADA">CANCELADA</option>
          <option value="FINALIZADA">FINALIZADA</option>
        </select>
      </div>

      <div class="col-md-5 d-flex gap-2">
        <button class="btn btn-outline-primary" (click)="filtrar()">
          <i class="uil uil-search"></i> Buscar
        </button>

        <button class="btn btn-outline-secondary" (click)="limpiarFiltros()">
          <i class="uil uil-times"></i> Limpiar
        </button>
      </div>

    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-4">
    <div class="spinner-border text-primary"></div>
  </div>

  <!-- Tabla -->
  <div *ngIf="!loading" class="card shadow-sm">
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>Sala</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Estado</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of reservas">
          <td>{{ r.sala }}</td>
          <td>{{ r.fechaInicio | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ r.fechaFin | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-success': r.estado === 'ACTIVA',
                'bg-danger': r.estado === 'CANCELADA',
                'bg-secondary': r.estado === 'FINALIZADA'
              }"
            >
              {{ r.estado }}
            </span>
          </td>
          <td class="text-center">
            <div class="d-flex justify-content-center gap-2">

              <button
                class="btn btn-sm btn-outline-primary"
                (click)="verDetalle(r.idReserva)"
                title="Ver detalle"
              >
                <i class="uil uil-eye"></i>
              </button>

              <button
                *ngIf="r.estado === 'ACTIVA'"
                class="btn btn-sm btn-outline-danger"
                (click)="cancelar(r)"
                title="Cancelar"
              >
                <i class="uil uil-times-circle"></i>
              </button>

            </div>
          </td>
        </tr>

        <tr *ngIf="reservas.length === 0">
          <td colspan="5" class="text-center py-5 text-muted">
            <i class="uil uil-calendar-slash d-block display-4 mb-2"></i>
            No hay reservas registradas
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="mt-4 d-flex justify-content-end" *ngIf="!loading && reservas.length > 0">
    <app-pagination
      [page]="page"
      [size]="size"
      [total]="total"
      (pageChange)="cambiarPagina($event)">
    </app-pagination>
  </div>

</div>
